@model CMCS.Controllers.UploadDocumentsViewModel
@{
    ViewData["Title"] = "Upload Supporting Documents";
}

<div class="row">
    <div class="col-md-12">
        <h1 class="text-light">Upload Supporting Documents</h1>
        <p class="text-muted">Upload documents for your existing claims</p>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card bg-dark text-light">
            <div class="card-header bg-secondary">
                <h5 class="mb-0 text-light">Upload Documents</h5>
            </div>
            <div class="card-body">
                <form asp-action="UploadDocuments" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="ClaimId" class="form-label text-light">Select Claim</label>
                        <select class="form-control bg-dark text-light" id="ClaimId" name="ClaimId" required>
                            <option value="">-- Select a claim --</option>
                            @foreach (var claim in Model.UserClaims)
                            {
                                <option value="@claim.Value">@claim.Text</option>
                            }
                        </select>
                        <div class="form-text text-light">Select the claim you want to upload documents for</div>
                        <span asp-validation-for="ClaimId" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label for="Files" class="form-label text-light">Select Documents</label>
                        <input type="file" class="form-control bg-dark text-light" id="Files" name="Files" multiple
                               accept=".pdf,.docx,.xlsx,.doc,.xls,.jpg,.jpeg,.png" required />
                        <div class="form-text text-light">
                            Supported formats: PDF, Word (.docx, .doc), Excel (.xlsx, .xls), Images (.jpg, .jpeg, .png)
                            <br>Maximum file size: 5MB per file
                        </div>
                        <span asp-validation-for="Files" class="text-danger"></span>
                    </div>

                    <div class="file-upload-info bg-secondary p-3 rounded mb-3">
                        <h6 class="text-light"><i class="bi bi-info-circle"></i> Upload Guidelines</h6>
                        <ul class="mb-0 text-light">
                            <li>Upload timesheets, attendance records, or other supporting evidence</li>
                            <li>Multiple files can be selected at once</li>
                            <li>Each file must be less than 5MB</li>
                            <li>Documents will be linked to your selected claim</li>
                        </ul>
                    </div>

                    <div class="form-group mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-upload"></i> Upload Documents
                        </button>
                        <a href="@Url.Action("Index", "Home")" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card bg-dark text-light">
            <div class="card-header bg-secondary">
                <i class="bi bi-file-earmark-text"></i> Document Requirements
            </div>
            <div class="card-body">
                <h6 class="text-light">Accepted File Types:</h6>
                <ul class="list-unstyled text-light">
                    <li><i class="bi bi-file-pdf text-danger"></i> PDF Documents</li>
                    <li><i class="bi bi-file-word text-primary"></i> Word Documents (.doc, .docx)</li>
                    <li><i class="bi bi-file-excel text-success"></i> Excel Spreadsheets (.xls, .xlsx)</li>
                    <li><i class="bi bi-file-image text-info"></i> Images (.jpg, .jpeg, .png)</li>
                </ul>

                <h6 class="text-light mt-3">File Size Limits:</h6>
                <ul class="list-unstyled text-light">
                    <li><i class="bi bi-check-circle text-success"></i> Maximum 5MB per file</li>
                    <li><i class="bi bi-check-circle text-success"></i> Multiple files allowed per claim</li>
                </ul>

                <div class="mt-3">
                    <h6 class="text-light">Need Help?</h6>
                    <p class="card-text small text-light">
                        Contact support if you have issues with file uploads:
                        <a href="mailto:support@example.com" style="color: #ccc;">support@example.com</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Recent Claims Card -->
        <div class="card bg-dark text-light mt-3">
            <div class="card-header bg-secondary">
                <i class="bi bi-clock-history"></i> Your Recent Claims
            </div>
            <div class="card-body">
                @if (Model.UserClaims.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var claim in Model.UserClaims.Take(5))
                        {
                            <div class="list-group-item bg-dark text-light border-secondary">
                                <small>@claim.Text</small>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted mb-0">No claims available for document upload.</p>
                    <a href="@Url.Action("SubmitClaim", "Home")" class="btn btn-sm btn-outline-primary mt-2">
                        <i class="bi bi-plus-circle"></i> Submit New Claim
                    </a>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // File size validation
        document.getElementById('Files').addEventListener('change', function() {
            const files = this.files;
            const maxSize = 5 * 1024 * 1024;

            for (let i = 0; i < files.length; i++) {
                if (files[i].size > maxSize) {
                    alert(`File "${files[i].name}" exceeds the 5MB size limit.`);
                    this.value = ''; 
                    break;
                }
            }
        });

        // Show file count
        document.getElementById('Files').addEventListener('change', function() {
            const fileCount = this.files.length;
            if (fileCount > 0) {
                const fileInfo = this.parentElement.querySelector('.form-text');
                if (fileInfo) {
                    const existingCount = fileInfo.querySelector('.file-count');
                    if (existingCount) {
                        existingCount.remove();
                    }
                    fileInfo.innerHTML += `<br><span class="text-info file-count">${fileCount} file(s) selected</span>`;
                }
            }
        });

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const claimId = document.getElementById('ClaimId').value;
            const files = document.getElementById('Files').files;

            if (!claimId) {
                e.preventDefault();
                alert('Please select a claim.');
                return false;
            }

            if (files.length === 0) {
                e.preventDefault();
                alert('Please select at least one file to upload.');
                return false;
            }
        });
    </script>
}