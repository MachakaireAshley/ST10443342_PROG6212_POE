@model CMCS.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="row">
    <div class="col-md-12">
        <h1>Welcome to Your Claims Dashboard</h1>
        <p class="text-muted">Claims overview for <strong>@ViewBag.CurrentMonth</strong></p>
    </div>
</div>

<!-- Display success/error messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>@TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>@TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row mt-4">
    <!-- Stats Cards -->
    <div class="col-md-3">
        <div class="stat-card stat-card-pending">
            <div class="display-6">@Model.PendingClaims</div>
            <p class="mb-0">Pending Claims</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card stat-card-rejected">
            <div class="display-6">@Model.RejectedClaims</div>
            <p class="mb-0">Rejected Claims</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card stat-card-approved">
            <div class="display-6">@Model.AcceptedClaims</div>
            <p class="mb-0">Approved Claims</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card stat-card-total">
            <div class="display-6">@Model.TotalClaims</div>
            <p class="mb-0">Total Claims</p>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Quick Actions
            </div>
            <div class="card-body">
                <div class="btn-group" role="group">
                    <a href="@Url.Action("SubmitClaim", "Home")" class="btn btn-primary mr-2">
                        <i class="bi bi-plus-circle"></i> Submit Claim
                    </a>
                    <a href="@Url.Action("UploadDocuments", "Home")" class="btn btn-secondary mr-2">
                        <i class="bi bi-upload"></i> Upload Documents
                    </a>
                    <a href="@Url.Action("ViewHistory", "Home")" class="btn btn-info mr-2">
                        <i class="bi bi-clock-history"></i> View History
                    </a>

                    @if (User.IsInRole("Coordinator") || User.IsInRole("Administrator"))
                    {
                        <a href="@Url.Action("Dashboard", "Coordinator")" class="btn btn-warning mr-2">
                            <i class="bi bi-eye"></i> Coordinator View
                        </a>
                    }

                    @if (User.IsInRole("Manager") || User.IsInRole("Administrator"))
                    {
                        <a href="@Url.Action("Dashboard", "Manager")" class="btn btn-success mr-2">
                            <i class="bi bi-star"></i> Manager View
                        </a>
                    }

                    @if (User.IsInRole("Administrator"))
                    {
                        <a href="@Url.Action("HR", "ManageLecturers")" class="btn btn-dark mr-2">
                            <i class="bi bi-people"></i> HR Management
                        </a>
                    }

                    <a href="@Url.Action("GenerateReport", "Home")" class="btn btn-outline-primary">
                        <i class="bi bi-file-earmark-bar-graph"></i> Generate Report
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Recent Claims</span>
                <a href="@Url.Action("ViewHistory", "Home")" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                @if (Model.RecentClaims.Any())
                {
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Claim ID</th>
                                <th>Date Submitted</th>
                                <th>Period</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var claim in Model.RecentClaims)
                            {
                                <tr>
                                    <td>CL-@claim.ClaimId.ToString("D4")</td>
                                    <td>@claim.SubmitDate.ToString("yyyy-MM-dd")</td>
                                    <td>@claim.Period</td>
                                    <td>R @claim.Amount.ToString("N2")</td>
                                    <td>
                                        @{
                                            var badgeClass = claim.Status switch
                                            {
                                                ClaimStatus.Pending => "badge-pending",
                                                ClaimStatus.Approved => "badge-approved",
                                                ClaimStatus.Rejected => "badge-rejected",
                                                ClaimStatus.CoordinatorApproved => "badge-pending", // Show as pending
                                                _ => "bg-secondary"
                                            };
                                            var statusDisplay = claim.Status switch
                                            {
                                                ClaimStatus.Pending => "Pending Coordinator",
                                                ClaimStatus.Approved => "Approved",
                                                ClaimStatus.Rejected => "Rejected",
                                                ClaimStatus.CoordinatorApproved => "Pending Manager",
                                                _ => claim.Status.ToString()
                                            };
                                        }
                                        <span class="badge @badgeClass">@statusDisplay</span>
                                    </td>
                                    <td>
                                        <a href="@Url.Action("Details", "Claims", new { id = claim.ClaimId })" class="btn btn-sm btn-info">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="bi bi-inbox display-4 text-muted"></i>
                        <p class="mt-3 text-muted">No claims found</p>
                        <a href="@Url.Action("SubmitClaim", "Home")" class="btn btn-primary mt-2">
                            <i class="bi bi-plus-circle"></i> Submit Your First Claim
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Notifications Section -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Notifications</span>
                <div>
                    <span class="badge bg-primary">@Model.Notifications.Count(n => !n.IsRead) New</span>
                    <span class="badge bg-secondary">@Model.Notifications.Count Total</span>
                </div>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush">
                    @foreach (var notification in Model.Notifications.Take(5))
                    {
                        <li class="list-group-item @(!notification.IsRead ? "bg-light" : "")">
                            <div class="d-flex w-100 justify-content-between">
                                <p class="mb-1 small">@notification.Content</p>
                                <small class="text-muted">@notification.Date.ToString("MMM dd")</small>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">From: @notification.Sender</small>
                                @if (!notification.IsRead)
                                {
                                    <span class="badge bg-primary">New</span>
                                }
                            </div>
                        </li>
                    }
                    @if (!Model.Notifications.Any())
                    {
                        <li class="list-group-item text-center text-muted py-3">
                            <i class="bi bi-bell display-6"></i>
                            <p class="mb-0 mt-2">No notifications</p>
                        </li>
                    }
                </ul>
                @if (Model.Notifications.Any())
                {
                    <div class="card-footer">
                        <a href="#" class="btn btn-sm btn-outline-primary w-100">View All Notifications</a>
                    </div>
                }
            </div>
        </div>

        <!-- Messages Section -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Messages</span>
                <div>
                    <span class="badge bg-info">@Model.Messages.Count(m => !m.IsRead) New</span>
                    <span class="badge bg-secondary">@Model.Messages.Count Total</span>
                </div>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush">
                    @foreach (var message in Model.Messages.Take(5))
                    {
                        <li class="list-group-item @(!message.IsRead ? "bg-light" : "")">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">@message.Sender</h6>
                                <small class="text-muted">@message.Date.ToString("MMM dd")</small>
                            </div>
                            <p class="mb-1 small">@message.Content</p>
                            @if (!message.IsRead)
                            {
                                <span class="badge bg-info">New</span>
                            }
                        </li>
                    }
                    @if (!Model.Messages.Any())
                    {
                        <li class="list-group-item text-center text-muted py-3">
                            <i class="bi bi-envelope display-6"></i>
                            <p class="mb-0 mt-2">No messages</p>
                        </li>
                    }
                </ul>
                @if (Model.Messages.Any())
                {
                    <div class="card-footer">
                        <a href="#" class="btn btn-sm btn-outline-primary w-100">View All Messages</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Quick Stats</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h5 class="display-6 text-primary">@Model.TotalClaims</h5>
                            <p class="mb-0">Total Claims</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h5 class="display-6 text-success">R @Model.RecentClaims.Sum(c => c.Amount).ToString("N2")</h5>
                            <p class="mb-0">Recent Amount</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h5 class="display-6 text-info">@(Model.RecentClaims.Any() ? Model.RecentClaims.Average(c => c.Workload).ToString("F1") : "0")</h5>
                            <p class="mb-0">Avg Workload (hours)</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h5 class="display-6 text-warning">@(Model.TotalClaims > 0 ? ((Model.AcceptedClaims / (double)Model.TotalClaims) * 100).ToString("F1") : "0")%</h5>
                            <p class="mb-0">Success Rate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>